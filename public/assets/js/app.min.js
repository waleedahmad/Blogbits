"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Config=function(){function a(){_classCallCheck(this,a);this.token=$("meta[name=csrf_token]").attr("content"),this.initHashNavigate(),this.initSchedulerTimings(this),this.initFbAlbumSync(this),this.initPostBackup(this)}return _createClass(a,[{key:"initHashNavigate",value:function(){var a=document.location.toString();a.match("#")&&$('.nav-tabs a[href="#'+a.split("#")[1]+'"]').tab("show"),$(".nav-tabs a").on("shown.bs.tab",function(a){window.location.hash=a.target.hash})}},{key:"getSchedulerStartTime",value:function(a){var b=$.trim($(a).val());return b?parseInt(b.match(/\d+/)[0]):0}},{key:"getSchedulerEndTime",value:function(a){var b=$.trim($(a).val());return b?parseInt(b.match(/\d+/)[0]):0}},{key:"initSchedulerTimings",value:function(a){$("#scheduler_start_time, #scheduler_end_time, #social_scheduler_start_time, #social_scheduler_end_time").timepicker({timeFormat:"H:i",step:function(a){return 60}}).keypress(function(a){a.preventDefault()}),$("#up-sch-timings, #up-sch-timings-social").on("click",function(b){b.preventDefault();var c,d,e=$(this).attr("data-type");"blog"===e?(c="#scheduler_start_time",d="#scheduler_end_time"):"social"===e&&(c="#social_scheduler_start_time",d="#social_scheduler_end_time");var f=a.getSchedulerStartTime(c),g=a.getSchedulerEndTime(d);$.ajax({type:"POST",url:"/config/scheduler/timings",data:{_token:a.token,start:f,end:g,type:e},success:function(a){a?toastr.success("Scheduler timings updated"):toastr.error("Unable to update Scheduler timings")}})})}},{key:"initFbAlbumSync",value:function(a){$("#sync-fb-albums").on("click",function(b){toastr.info("Syncing facebook albums"),b.preventDefault(),$.ajax({type:"POST",url:"/social/sync/fbAlbums",data:{_token:a.token},success:function(a){a&&toastr.success("Facebook albums synced")}})})}},{key:"initPostBackup",value:function(a){$("#backup-content").on("click",function(b){b.preventDefault(),toastr.info("Backing up all posts!"),$.ajax({type:"POST",url:"/content/backup",data:{_token:a.token},success:function(a){a&&toastr.success("All Photos backed up!")}})})}}]),a}();new Config;var Posts=function(){function a(){_classCallCheck(this,a),this.token=$("meta[name=csrf_token]").attr("content"),this.flash_message=$("#flash-message"),this.initInfiniteScroll(this),this.initPostTags(this),this.initPost()}return _createClass(a,[{key:"initInfiniteScroll",value:function(a){var b=$(".grid");$(b).jscroll({debug:!1,autoTrigger:!0,nextSelector:".pagination li:last a",contentSelector:".post, .pagination",callback:function(){$("ul.pagination:visible:first").remove(),$(".jscroll-added > *").unwrap(),a.initPostTags(a),a.initPost(a)}})}},{key:"initPostTags",value:function(a){$(".tags").tagsinput({allowDuplicates:!1,trimValue:!0}),$(".tags").off("itemAdded").on("itemAdded",function(b){var c=$(this).tagsinput("items").join(),d=$(this).attr("data-id");a.updatePostTags(d,c,a)}),$(".tags").off("itemRemoved").on("itemRemoved",function(b){var c=$(this).tagsinput("items").join(),d=$(this).attr("data-id");a.updatePostTags(d,c,a)})}},{key:"updatePostTags",value:function(a,b,c){$.ajax({type:"POST",url:"/content/update/tags",data:{post_id:a,tags:b,_token:c.token}})}},{key:"initPost",value:function(){$(".delete-now").off("click").on("click",{context:this},this.deletePost),$(".post-now").off("click").on("click",{context:this},this.createPost),$("#post-batch").off("click").on("click",{context:this},this.createPostBatch)}},{key:"createPostBatch",value:function(a){a.preventDefault();var b=a.data.context;toastr.info("Posting post batch..."),$(this).unbind("click"),$.ajax({type:"POST",url:"/content/post/batch",data:{_token:b.token},success:function(a){a&&($(this).unbind("click"),toastr.success("Post batch posted..."),b.removePostBatchFromDOM())}})}},{key:"removePostBatchFromDOM",value:function(){$.ajax({type:"GET",url:"/config/posts/batchLimit",success:function(a){$(".row:lt("+a.batch_limit+")").slideUp()}})}},{key:"createPost",value:function(a){var b=a.data.context,c=$(this),d=$(this).attr("data-id"),e=$(this).attr("data-type");$(this).unbind("click"),toastr.info("Posting new post..."),$.ajax({type:"POST",url:"/content/post/"+e,data:{_token:b.token,post_id:d},success:function(a){a?(toastr.success("Posted..."),$(c).parents(".post").slideUp()):$(".post-now").on("click",{context:this},this.createPost)}})}},{key:"deletePost",value:function(a){var b=a.data.context,c=$(this),d=$(this).attr("data-id");$(this).unbind("click"),$.ajax({type:"DELETE",url:"/content/delete",data:{_token:b.token,post_id:d},success:function(a){a?$(c).parents(".post").slideUp(function(){$(this).remove()}):$(".delete-now").on("click",{context:this},this.deletePost)}})}}]),a}();new Posts;var ContentSync=function(){function a(){_classCallCheck(this,a),this.token=$("meta[name=csrf_token]").attr("content"),this.flash_message=$("#flash-message"),$("#sync-data").on("click",{uri:"/content/sync",name:"Tumblr"},this.requestSync),$("#facebook-sync").on("click",{uri:"/content/sync/facebook",name:"Facebook"},this.requestSync),$("#pinterest-sync").on("click",{uri:"/content/sync/pinterest",name:"Pinterest"},this.requestSync),this.initDeleteSync(this)}return _createClass(a,[{key:"requestSync",value:function(a){a.preventDefault();var b=a.data.uri,c=a.data.name;toastr.info("Sync in progress, please wait..."),$(this).unbind("click"),$.ajax({type:"GET",url:b,data:{_token:this.token},success:function(a){a&&(toastr.success("success",c+" Content successfully synced..."),setTimeout(function(){window.location.reload()},3e3))}})}},{key:"initDeleteSync",value:function(a){$("#delete-sync, #facebook-delete-sync, #pinterest-delete-sync").on("click",function(b){b.preventDefault();var c=$(this).attr("data-service"),d=$(this).attr("data-name");confirm("Are you sure you want to delete all "+d+" synced content?")?(toastr.info("Deleting all synced content..."),$(this).unbind("click"),$.ajax({type:"DELETE",url:"/content/deleteAll/"+c,data:{_token:a.token},success:function(a){a&&(toastr.success("Content successfully removed..."),$(".grid").fadeOut(function(){$(this).remove()}))}})):toastr.info("Deleting content cancelled..")})}},{key:"initSocialDeleteSync",value:function(a){$("#social-delete-sync").on("click",function(b){b.preventDefault(),confirm("Are you sure you want to delete all synced content?")?(toastr.info("Deleting all social synced content..."),$(this).unbind("click"),$.ajax({type:"DELETE",url:"/content/deleteAll/social",data:{_token:a.token},success:function(a){a&&(toastr.success("Content successfully removed..."),$(".grid").fadeOut(function(){$(this).remove()}))}})):toastr.info("Deleting social content cancelled..")})}}]),a}();new ContentSync,toastr.options={debug:!1,positionClass:"toast-bottom-right",onclick:null,fadeIn:300,fadeOut:1e3,timeOut:5e3,extendedTimeOut:1e3,newestOnTop:!1};